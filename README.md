# ????Terraform??????????

**???????????????????????**???????????????????????????Terraform?Kubernetes?????????

## ?????

- **????????**: ?????Kubernetes?????GKE?EKS?AKS??????
- **??????????**: Minikube?kind?k3d???????K8s?????
- **?????????**: ???????????

## ??

- **????????**: Python Flask???????????HTTP????
- **Terraform**: Kubernetes???????
- **Kubernetes**: ???????Minikube?kind?k3d????????

## ?????

- Docker & Docker Compose?**???????**?
- Terraform >= 1.0
- Kubernetes?Minikube?kind??????????K8s???
- kubectl

> **?? ??**: Python?????????????Docker Compose???????????????

## ????????

### ?? ???????: Docker Compose

```bash
# ??????????????
docker-compose up -d

# ???Makefile????
make docker-compose-up

# ?????
docker-compose logs -f
# ???
make docker-compose-logs

# ??
docker-compose down
# ???
make docker-compose-down
```

????? `http://localhost:8080` ????????????????

### 1. ????????????????Python???

```bash
# ???????????
pip install -r requirements.txt

# ??????
python app.py
# ???
make run
```

????? `http://localhost:8080` ????????????????

### 2. Docker???????????

```bash
# ????????
docker build -t sample-app:latest .
# ???
make docker-build

# ??????????
docker run -p 8080:8080 sample-app:latest
# ???
make docker-run
```

### 3. Kubernetes?????????????????

#### Minikube???
```bash
# Minikube???
minikube start

# Minikube?Docker?????
eval $(minikube docker-env)

# ??????????Minikube?????????????
docker build -t sample-app:latest .
```

#### kind???
```bash
# kind???????
kind create cluster --name sample

# ????????
docker build -t sample-app:latest .
kind load docker-image sample-app:latest --name sample
```

#### k3d???
```bash
# k3d???????
k3d cluster create sample

# ????????????????
# k3d??????????????????????????
```

### 4. Terraform?????

```bash
# Terraform????
terraform init
# ???
make terraform-init

# ???????
terraform plan
# ???
make terraform-plan

# ???????
terraform apply
# ???
make terraform-apply

# ?????
terraform show
```

### 5. Kubernetes??????

```bash
# Pod?????
kubectl get pods -n sample-app

# Service???
kubectl get svc -n sample-app

# ?????
kubectl logs -n sample-app -l app=sample-app

# Port Forwarding?????
kubectl port-forward -n sample-app svc/sample-app-service 8080:80
```

????`http://localhost:8080` ????????????????

### 6. ???????

```bash
# Terraform???????
terraform destroy
# ???
make terraform-destroy

# ????kubectl?????
kubectl delete namespace sample-app

# Docker Compose????????
docker-compose down
```

## ???

### ????????????

```bash
# ???????
curl http://localhost:8080/health

# ??????????
curl http://localhost:8080/

# ???????????Python??????
python test_app.py
# ???
make test
```

### Kubernetes???????

```bash
# Deployment???
kubectl get deployment -n sample-app

# ReplicaSet???
kubectl get rs -n sample-app

# ??????????
kubectl get all -n sample-app
```

## ??????

```
.
??? app.py                 # ???????????
??? requirements.txt       # Python????
??? Dockerfile            # Docker??????
??? docker-compose.yml    # Docker Compose?????????
??? main.tf               # Terraform?????
??? outputs.tf            # Terraform????
??? k8s-manifests.yaml    # Kubernetes???????????
??? test_app.py           # ????????
??? Makefile              # ????????
??? README.md             # ??????
```

## ??????

1. **Terraform??**: `main.tf`?Kubernetes???????
2. **Provider??**: Kubernetes provider?????
3. **??????**: Deployment?Service?Namespace???
4. **??????**: Minikube???????K8s????????
5. **????**: `terraform plan`?`terraform apply`????

## ???????????

### Terraform?Kubernetes?????????

- `~/.kube/config`??????????
- `kubectl config current-context`??????????
- `main.tf`?`config_context`??????????????????????????????????????

### ?????????????

- Minikube??????????`eval $(minikube docker-env)`???????????????
- ??????????????Docker Hub????????????
- kind????`kind load docker-image`?????????????

### Docker Compose?????????

- Docker?Docker Compose???????????????
- ???8080??????????????????

## ??????????????

?? **?????????????????????????????????????????????**

1. **???????**: 
   - `DEBUG=True`??????????????
   - ??????`DEBUG=False`???????`DEBUG=False`???

2. **?root????**: 
   - Dockerfile???root?????appuser??????????????

3. **????**: 
   - ??????API??????????????????
   - ??????Kubernetes Secrets???

4. **??????**: 
   - ???????????????
   - ????????

5. **????**: 
   - ????`requirements.txt`?????????????

## ??????

- ???????
- ConfigMap/Secret???
- Ingress???
- Helm????
- CI/CD?????????

## ????????Makefile?

```bash
make help              # ???????????
make docker-compose-up # Docker Compose???????
make test              # ???????
make terraform-init    # Terraform???
make terraform-apply   # Terraform?????
```
