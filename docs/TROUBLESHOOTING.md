# ??????????????

????????????????????

## Docker Compose??

### ??: `docker-compose up` ?????????

**????**:
```
ERROR: Couldn't connect to Docker daemon
```

**????**:
```bash
# Docker??????????????
sudo systemctl status docker

# ?????????
sudo systemctl start docker

# ?????docker?????????????????
sudo usermod -aG docker $USER
```

### ??: ???8080??????????

**????**:
```
Error: bind: address already in use
```

**????**:
```bash
# ???8080??????????????
sudo lsof -i :8080
# ???
sudo netstat -tlnp | grep 8080

# ???????????docker-compose.yml???????
# ?: "8081:8080" ???
```

## Kubernetes??

### ??: `kubectl` ??????????

**????**:
```
The connection to the server localhost:8080 was refused
```

**????**:
```bash
# kubeconfig????????
ls ~/.kube/config

# Minikube???
minikube status
minikube start

# kind???
kind get clusters
# ???????????????
kind create cluster --name sample
```

### ??: Pod???????ImagePullBackOff?

**????**:
```bash
kubectl describe pod -n sample-app <pod-name>
```

**????**:
```bash
# Minikube???: ?????Minikube??????
eval $(minikube docker-env)
docker build -t sample-app:latest .
eval $(minikube docker-env -u)  # ????

# kind???: ????????
kind load docker-image sample-app:latest --name sample

# ???????????????????
docker images | grep sample-app
```

### ??: Pod?CrashLoopBackOff??????

**????**:
```bash
# Pod?????
kubectl get pods -n sample-app

# ?????
kubectl logs -n sample-app <pod-name>

# ????????
kubectl describe pod -n sample-app <pod-name>
```

**???????????**:
1. **???????????**: ?????????
2. **??????**: Resource Limits???
3. **?????**: ConfigMap????????

### ??: Service???????

**????**:
```bash
# Service?????
kubectl get svc -n sample-app

# Service?????
kubectl describe svc -n sample-app sample-app-service

# Endpoints????????
kubectl get endpoints -n sample-app
```

**????**:
```bash
# Pod?Running?????????????
kubectl get pods -n sample-app --show-labels

# Service?selector?Pod?labels??????????
kubectl get svc -n sample-app sample-app-service -o yaml | grep selector
kubectl get pods -n sample-app --show-labels
```

## Terraform??

### ??: `terraform init` ?????????

**????**:
```
Error: Failed to query available provider packages
```

**????**:
```bash
# ????????????
ping registry.terraform.io

# Terraform??????????>= 1.0????
terraform version

# .terraform???????????????
rm -rf .terraform
terraform init
```

### ??: `terraform apply` ?Kubernetes???????

**????**:
```
Error: Get "http://localhost:8080/api/v1/namespaces": dial tcp [::1]:8080: connect: connection refused
```

**????**:
```bash
# kubectl????????
kubectl cluster-info

# kubeconfig??????
echo $KUBECONFIG
# ???
ls ~/.kube/config

# main.tf?config_path???????
# ~/.kube/config ???????

# ?????????
kubectl config current-context
# main.tf?config_context???????????????????
```

### ??: `terraform destroy` ?????????

**????**:
```
Error: resource "kubernetes_deployment" does not support import
```

**????**:
```bash
# ??????????
kubectl delete namespace sample-app

# Terraform??????
terraform state list

# ????????????: ???????
rm terraform.tfstate*
```

### ??: Terraform???????????

**??**: Plan??????????????

**????**:
```bash
# ?????
terraform show

# ?????????????
terraform refresh

# ??????????????
terraform import kubernetes_namespace.sample_app sample-app
```

## ??????????

### ??: ??????????????

**????**:
```bash
# Docker Compose???
docker-compose logs

# Kubernetes???
kubectl logs -n sample-app -l app=sample-app

# Pod??????
kubectl exec -it -n sample-app <pod-name> -- curl localhost:8080/health
```

**????**:
1. ?????????????
2. ?????????????8080?
3. ??????????????????

### ??: ????????

**????**:
```
Connection refused
```

**????**:
```bash
# ?????????????
curl http://localhost:8080/health

# Docker Compose??????????
docker-compose ps

# ?????
docker-compose logs sample-app
```

## ????????????

### Kubernetes
```bash
# ???????????
kubectl get all -n sample-app

# ???????
kubectl get events -n sample-app --sort-by='.lastTimestamp'

# Pod?????
kubectl describe pod -n sample-app <pod-name>

# ????????
kubectl exec -it -n sample-app <pod-name> -- /bin/sh
```

### Terraform
```bash
# ?????????
terraform plan -out=tfplan
terraform show tfplan

# ?????
terraform state list
terraform state show <resource-name>

# ???????
terraform validate
terraform fmt -check
```

### Docker
```bash
# ???????
docker images | grep sample-app

# ???????
docker ps -a | grep sample-app

# ?????
docker logs sample-app

# ????????
docker exec -it sample-app /bin/sh
```

## ???????FAQ?

### Q: Minikube?kind??????????
**A**: ?????OK?????????Minikube??????kind???????????????????

### Q: Terraform????????????????
**A**: ????????`.gitignore`?????????????????????Terraform Cloud?S3???????????????????

### Q: ?????????????????
**A**: ?????????????Minikube?kind???????????????

### Q: ??????????
**A**: ????????????????????????????????????????????????????????

## ???????????

1. **?????**: ??????????????
2. **???????????**: Terraform/Kubernetes/Docker?????????
3. **????????**: ????????????????????
4. **??????????**: ???????????????????

```bash
# ??????????
terraform destroy
kubectl delete namespace sample-app
docker-compose down
docker rmi sample-app:latest  # ??????
```
